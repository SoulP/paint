<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="ja"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../jacoco-resources/report.gif" type="image/gif"/><title>BMP.java</title><link rel="stylesheet" href="../../../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">paint (2018/03/28 9:59:50)</a> &gt; <a href="../../index.html" class="el_group">paint</a> &gt; <a href="../index.html" class="el_bundle">src</a> &gt; <a href="index.source.html" class="el_package">file.io</a> &gt; <span class="el_source">BMP.java</span></div><h1>BMP.java</h1><pre class="source lang-java linenums">package file.io;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileOutputStream;
import java.io.IOException;
import java.nio.ByteBuffer;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import file.Tools;
import file.format.bmp.BMP_V1;
import file.format.bmp.BMP_V2;
import file.format.bmp.BMP_V3;
import file.format.bmp.BMP_V4;
import file.format.bmp.BMP_V5;
import file.format.bmp.BMPable;

/**
 * &lt;b&gt;BMP入出力&lt;/b&gt;&lt;br&gt;
 * date: 2017/10/12 last_date: 2018/03/27
 * 
 * @author ソウルP
 * @version 1.0 2017/10/12 BMP作成
 * @version 1.1 2017/10/18 各情報ヘッダに対応
 * @version 1.2 2017/10/27 GAP1（オプショナル）追加、GAP2（オプショナル）追加、プロファイル追加
 */
public class BMP {
    private BMPable      bmp;
    private byte[]       type;           // ファイルタイプ
    private int          fileSize;       // ファイルサイズ
    private int          imageOffset;    // 画像データオフセット
    private int          infoHeaderSize; // 情報ヘッダサイズ
    private int          width;          // 幅
    private int          height;         // 高さ
    private int          bitCount;       // ビット数
    private int          compression;    // 圧縮形式
    private int          imageSize;      // 画像データサイズ
    private int          pixPerMeterX;   // 水平方向の解像度
    private int          pixPerMeterY;   // 垂直方向の解像度
    private int          cirImportant;   // 重要な色数
    private byte[]       redMask;        // 赤成分のカラーマスク
    private byte[]       greenMask;      // 緑成分のカラーマスク
    private byte[]       blueMask;       // 青成分のカラーマスク
    private byte[]       alphaMask;      // α成分のカラーマスク
    private byte[]       csType;         // 色空間
    private byte[]       ciexyzTriple;   // CIEXYZTRIPLE構造体
    private float        gammaRed;       // 赤成分のガンマ値
    private float        gammaGreen;     // 緑成分のガンマ値
    private float        gammaBlue;      // 青成分のガンマ値
    private int          intent;         // レンダリングの意図
    private int          profileOffset;  // プロファイルデータオフセット
    private int          profileSize;    // プロファイルデータサイズ
    private int          headerSize;     // ヘッダサイズ
    private int          hotspotX;       // ホットスポット x
    private int          hotspotY;       // ホットスポット y
    private int          resolution;     // 解像度の単位
    private int          format;         // 記録方式
    private int          halftone;       // ハーフトーンの方式
    private int          halftoneParam1; // ハーフトーン時のパラメータ1
    private int          halftoneParam2; // ハーフトーン時のパラメータ2
    private int          encoding;       // 符号化方式
    private int          id;             // 識別子
    private byte[]       gap1;           // オプショナル
    private byte[]       gap2;           // オプショナル
    private byte[]       profile;        // プロファイル

    private List&lt;byte[]&gt; colors;         // カラーパレット
    private byte[]       bitfields;      // ビットフィールド
    private List&lt;byte[]&gt; image;          // イメージ

    /**
     * &lt;b&gt;BMP&lt;/b&gt;
     */
<span class="fc" id="L76">    public BMP() {</span>
<span class="fc" id="L77">        colors = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L78">        image = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L79">        clear();</span>
<span class="fc" id="L80">    }</span>

    /**
     * &lt;b&gt;BMP&lt;/b&gt;
     * 
     * @param version
     *            バージョン
     */
    public BMP(int version) {
<span class="fc" id="L89">        this();</span>
<span class="fc" id="L90">        setVersion(version);</span>
<span class="fc" id="L91">    }</span>

    /**
     * &lt;b&gt;BMP&lt;/b&gt;&lt;br&gt;
     * 読み込み
     * 
     * @param file
     *            入力先
     * @throws IOException
     */
    public BMP(String file) throws IOException {
<span class="fc" id="L102">        this();</span>
<span class="fc" id="L103">        input(file);</span>
<span class="fc" id="L104">    }</span>

    /**
     * 2 バイト
     * 
     * @return ファイルタイプ
     */
    public byte[] getType() {
<span class="fc" id="L112">        return type;</span>
    }

    /**
     * 2 バイト
     * 
     * @param type
     *            ファイルタイプ
     */
    public void setType(byte[] type) {
<span class="fc" id="L122">        this.type = type;</span>
<span class="fc" id="L123">    }</span>

    /**
     * V1, V3 - V5
     * 
     * @return ファイルサイズ
     */
    public int getFileSize() {
<span class="fc" id="L131">        return fileSize;</span>
    }

    /**
     * V1, V3 - V5
     * 
     * @param fileSize
     *            ファイルサイズ
     */
    public void setFileSize(int fileSize) {
<span class="fc" id="L141">        this.fileSize = fileSize;</span>
<span class="fc" id="L142">    }</span>

    /**
     * @return 画像データへのオフセット
     */
    public int getImageOffset() {
<span class="fc" id="L148">        return imageOffset;</span>
    }

    /**
     * @param imageOffset
     *            画像データへのオフセット
     */
    public void setImageOffset(int imageOffset) {
<span class="fc" id="L156">        this.imageOffset = imageOffset;</span>
<span class="fc" id="L157">    }</span>

    /**
     * @return 情報ヘッダのサイズ
     */
    public int getInfoHeaderSize() {
<span class="fc" id="L163">        return infoHeaderSize;</span>
    }

    /**
     * @param infoHeaderSize
     *            情報ヘッダのサイズ
     */
    public void setInfoHeaderSize(int infoHeaderSize) {
<span class="fc" id="L171">        this.infoHeaderSize = infoHeaderSize;</span>
<span class="fc" id="L172">    }</span>

    /**
     * V1: 2 バイト&lt;br&gt;
     * V2 - V5: 4 バイト
     * 
     * @return 幅
     */
    public int getWidth() {
<span class="fc" id="L181">        return width;</span>
    }

    /**
     * V1: 2 バイト&lt;br&gt;
     * V2 - V5: 4 バイト
     * 
     * @param width
     *            幅
     */
    public void setWidth(int width) {
<span class="fc" id="L192">        this.width = width;</span>
<span class="fc" id="L193">    }</span>

    /**
     * V1: 2 バイト&lt;br&gt;
     * V2 - V5: 4 バイト
     * 
     * @return 高さ
     */
    public int getHeight() {
<span class="fc" id="L202">        return height;</span>
    }

    /**
     * V1: 2 バイト&lt;br&gt;
     * V2 - V5: 4 バイト
     * 
     * @param height
     *            高さ
     */
    public void setHeight(int height) {
<span class="fc" id="L213">        this.height = height;</span>
<span class="fc" id="L214">    }</span>

    /**
     * @return ビット数
     */
    public int getBitCount() {
<span class="fc" id="L220">        return bitCount;</span>
    }

    /**
     * @param bitCount
     *            ビット数
     */
    public void setBitCount(int bitCount) {
<span class="fc" id="L228">        this.bitCount = bitCount;</span>
<span class="fc" id="L229">    }</span>

    /**
     * V2 - V5
     * 
     * @return 圧縮形式
     */
    public int getCompression() {
<span class="fc" id="L237">        return compression;</span>
    }

    /**
     * V2 - V5
     * 
     * @param compression
     *            圧縮形式
     */
    public void setCompression(int compression) {
<span class="fc" id="L247">        this.compression = compression;</span>
<span class="fc" id="L248">    }</span>

    /**
     * V2 - V5
     * 
     * @return 画像データのサイズ
     */
    public int getImageSize() {
<span class="fc" id="L256">        return imageSize;</span>
    }

    /**
     * V2 - V5
     * 
     * @param imageSize
     *            画像データのサイズ
     */
    public void setImageSize(int imageSize) {
<span class="fc" id="L266">        this.imageSize = imageSize;</span>
<span class="fc" id="L267">    }</span>

    /**
     * V2 - V5
     * 
     * @return 水平方向の解像度
     */
    public int getPixPerMeterX() {
<span class="fc" id="L275">        return pixPerMeterX;</span>
    }

    /**
     * V2 - V5
     * 
     * @param pixPerMeterX
     *            水平方向の解像度
     */
    public void setPixPerMeterX(int pixPerMeterX) {
<span class="fc" id="L285">        this.pixPerMeterX = pixPerMeterX;</span>
<span class="fc" id="L286">    }</span>

    /**
     * V2 - V5
     * 
     * @return 垂直方向の解像度
     */
    public int getPixPerMeterY() {
<span class="fc" id="L294">        return pixPerMeterY;</span>
    }

    /**
     * V2 - V5
     * 
     * @param pixPerMeterY
     *            垂直方向の解像度
     */
    public void setPixPerMeterY(int pixPerMeterY) {
<span class="fc" id="L304">        this.pixPerMeterY = pixPerMeterY;</span>
<span class="fc" id="L305">    }</span>

    /**
     * V2 - V5
     * 
     * @return 使用する色数
     */
    public int getClrUsed() {
<span class="fc" id="L313">        return colors.size();</span>
    }

    /**
     * V2 - V5&lt;br&gt;
     * &lt;br&gt;
     * 全てが必要な場合、値は0
     * 
     * @return 重要な色数
     */
    public int getCirImportant() {
<span class="fc" id="L324">        return cirImportant;</span>
    }

    /**
     * V2 - V5&lt;br&gt;
     * &lt;br&gt;
     * 全てが必要な場合、値は0
     * 
     * @param cirImportant
     *            重要な色数
     */
    public void setCirImportant(int cirImportant) {
<span class="fc" id="L336">        this.cirImportant = cirImportant;</span>
<span class="fc" id="L337">    }</span>

    /**
     * V4 - V5&lt;br&gt;
     * &lt;br&gt;
     * 4 バイト
     * 
     * @return 赤成分のカラーマスク
     */
    public byte[] getRedMask() {
<span class="fc" id="L347">        return redMask;</span>
    }

    /**
     * V4 - V5&lt;br&gt;
     * &lt;br&gt;
     * 4 バイト
     * 
     * @param redMask
     *            赤成分のカラーマスク
     */
    public void setRedMask(byte[] redMask) {
<span class="fc" id="L359">        this.redMask = redMask;</span>
<span class="fc" id="L360">    }</span>

    /**
     * V4 - V5&lt;br&gt;
     * &lt;br&gt;
     * 4 バイト
     * 
     * @return 緑成分のカラーマスク
     */
    public byte[] getGreenMask() {
<span class="fc" id="L370">        return greenMask;</span>
    }

    /**
     * V4 - V5&lt;br&gt;
     * &lt;br&gt;
     * 4 バイト
     * 
     * @param greenMask
     *            緑成分のカラーマスク
     */
    public void setGreenMask(byte[] greenMask) {
<span class="fc" id="L382">        this.greenMask = greenMask;</span>
<span class="fc" id="L383">    }</span>

    /**
     * V4 - V5&lt;br&gt;
     * &lt;br&gt;
     * 4 バイト
     * 
     * @return 青成分のカラーマスク
     */
    public byte[] getBlueMask() {
<span class="fc" id="L393">        return blueMask;</span>
    }

    /**
     * V4 - V5&lt;br&gt;
     * &lt;br&gt;
     * 4 バイト
     * 
     * @param blueMask
     *            青成分のカラーマスク
     */
    public void setBlueMask(byte[] blueMask) {
<span class="fc" id="L405">        this.blueMask = blueMask;</span>
<span class="fc" id="L406">    }</span>

    /**
     * V4 - V5&lt;br&gt;
     * &lt;br&gt;
     * 4 バイト
     * 
     * @return α成分のカラーマスク
     */
    public byte[] getAlphaMask() {
<span class="fc" id="L416">        return alphaMask;</span>
    }

    /**
     * V4 - V5&lt;br&gt;
     * &lt;br&gt;
     * 4 バイト
     * 
     * @param alphaMask
     *            α成分のカラーマスク
     */
    public void setAlphaMask(byte[] alphaMask) {
<span class="fc" id="L428">        this.alphaMask = alphaMask;</span>
<span class="fc" id="L429">    }</span>

    /**
     * V4 - V5&lt;br&gt;
     * &lt;br&gt;
     * ４ バイト
     * 
     * @return 色空間
     */
    public byte[] getCSType() {
<span class="fc" id="L439">        return csType;</span>
    }

    /**
     * V4 - V5&lt;br&gt;
     * &lt;br&gt;
     * ４ バイト
     * 
     * @param csType
     *            色空間
     */
    public void setCSType(byte[] csType) {
<span class="fc" id="L451">        this.csType = csType;</span>
<span class="fc" id="L452">    }</span>

    /**
     * V4 - V5&lt;br&gt;
     * &lt;br&gt;
     * 36 バイト
     * 
     * @return CIEXYZTRIPLE構造体
     */
    public byte[] getCiexyzTriple() {
<span class="fc" id="L462">        return ciexyzTriple;</span>
    }

    /**
     * V4 - V5&lt;br&gt;
     * &lt;br&gt;
     * 36 バイト
     * 
     * @param ciexyzTriple
     *            CIEXYZTRIPLE構造体
     */
    public void setCiexyzTriple(byte[] ciexyzTriple) {
<span class="fc" id="L474">        this.ciexyzTriple = ciexyzTriple;</span>
<span class="fc" id="L475">    }</span>

    /**
     * V4 - V5
     * 
     * @return 赤成分のガンマ値
     */
    public float getGammaRed() {
<span class="fc" id="L483">        return gammaRed;</span>
    }

    /**
     * V4 - V5
     * 
     * @param gammaRed
     *            赤成分のガンマ値
     */
    public void setGammaRed(float gammaRed) {
<span class="fc" id="L493">        this.gammaRed = gammaRed;</span>
<span class="fc" id="L494">    }</span>

    /**
     * V4 - V5
     * 
     * @return 緑成分のガンマ値
     */
    public float getGammaGreen() {
<span class="fc" id="L502">        return gammaGreen;</span>
    }

    /**
     * V4 - V5
     * 
     * @param gammaGreen
     *            緑成分のガンマ値
     */
    public void setGammaGreen(float gammaGreen) {
<span class="fc" id="L512">        this.gammaGreen = gammaGreen;</span>
<span class="fc" id="L513">    }</span>

    /**
     * V4 - V5
     * 
     * @return 青成分のガンマ値
     */
    public float getGammaBlue() {
<span class="fc" id="L521">        return gammaBlue;</span>
    }

    /**
     * V4 - V5
     * 
     * @param gammaBlue
     *            青成分のガンマ値
     */
    public void setGammaBlue(float gammaBlue) {
<span class="fc" id="L531">        this.gammaBlue = gammaBlue;</span>
<span class="fc" id="L532">    }</span>

    /**
     * V5
     * 
     * @return レンダリングの意図
     */
    public int getIntent() {
<span class="fc" id="L540">        return intent;</span>
    }

    /**
     * V5
     * 
     * @param intent
     *            レンダリングの意図
     */
    public void setIntent(int intent) {
<span class="fc" id="L550">        this.intent = intent;</span>
<span class="fc" id="L551">    }</span>

    /**
     * V5
     * 
     * @return プロファイルデータのオフセット
     */
    public int getProfileOffset() {
<span class="fc" id="L559">        return profileOffset;</span>
    }

    /**
     * V5
     * 
     * @param profileOffset
     *            プロファイルデータのオフセット
     */
    public void setProfileOffset(int profileOffset) {
<span class="fc" id="L569">        this.profileOffset = profileOffset;</span>
<span class="fc" id="L570">    }</span>

    /**
     * V5
     * 
     * @return プロファイルデータのサイズ
     */
    public int getProfileSize() {
<span class="fc" id="L578">        return profile.length;</span>
    }

    /**
     * V2
     * 
     * @return ファイルヘッダと情報ヘッダの合計サイズ
     */
    public int getHeaderSize() {
<span class="fc bfc" id="L587" title="All 2 branches covered.">        if (headerSize &lt; (BMPable.FILE_HEADER_SIZE + BMPable.INFO_HEADER_SIZE_V2_MIN)) {</span>
<span class="fc" id="L588">            headerSize = BMPable.FILE_HEADER_SIZE + infoHeaderSize;</span>
        }
<span class="fc" id="L590">        return headerSize;</span>
    }

    /**
     * V2
     * 
     * @param headerSize
     *            ファイルヘッダと情報ヘッダの合計サイズ
     */
    public void setHeaderSize(int headerSize) {
<span class="fc" id="L600">        this.headerSize = headerSize;</span>
<span class="fc" id="L601">    }</span>

    /**
     * V2
     * 
     * @return ポインタのホットスポットの x 座標
     */
    public int getHotspotX() {
<span class="fc" id="L609">        return hotspotX;</span>
    }

    /**
     * V2
     * 
     * @param hotspotX
     *            ポインタのホットスポットの x 座標
     */
    public void setHotspotX(int hotspotX) {
<span class="fc" id="L619">        this.hotspotX = hotspotX;</span>
<span class="fc" id="L620">    }</span>

    /**
     * V2
     * 
     * @return ポインタのホットスポットの y 座標
     */
    public int getHotspotY() {
<span class="fc" id="L628">        return hotspotY;</span>
    }

    /**
     * V2
     * 
     * @param hotspotY
     *            ポインタのホットスポットの y 座標
     */
    public void setHotspotY(int hotspotY) {
<span class="fc" id="L638">        this.hotspotY = hotspotY;</span>
<span class="fc" id="L639">    }</span>

    /**
     * V2
     * 
     * @return 解像度の単位
     */
    public int getResolution() {
<span class="fc" id="L647">        return resolution;</span>
    }

    /**
     * V2
     * 
     * @param resolution
     *            解像度の単位
     */
    public void setResolution(int resolution) {
<span class="fc" id="L657">        this.resolution = resolution;</span>
<span class="fc" id="L658">    }</span>

    /**
     * V2
     * 
     * @return 記録方式
     */
    public int getFormat() {
<span class="fc" id="L666">        return format;</span>
    }

    /**
     * V2
     * 
     * @param format
     *            記録方式
     */
    public void setFormat(int format) {
<span class="fc" id="L676">        this.format = format;</span>
<span class="fc" id="L677">    }</span>

    /**
     * V2
     * 
     * @return ハーフトーンの方式
     */
    public int getHaltone() {
<span class="fc" id="L685">        return halftone;</span>
    }

    /**
     * V2
     * 
     * @param halftone
     *            ハーフトーンの方式
     */
    public void setHalftone(int halftone) {
<span class="fc" id="L695">        this.halftone = halftone;</span>
<span class="fc" id="L696">    }</span>

    /**
     * V2
     * 
     * @return ハーフトーン時のパラメータ1
     */
    public int getHalftoneParam1() {
<span class="fc" id="L704">        return halftoneParam1;</span>
    }

    /**
     * V2
     * 
     * @param halftoneParam1
     *            ハーフトーン時のパラメータ1
     */
    public void setHalftoneParam1(int halftoneParam1) {
<span class="fc" id="L714">        this.halftoneParam1 = halftoneParam1;</span>
<span class="fc" id="L715">    }</span>

    /**
     * V2
     * 
     * @return ハーフトーン時のパラメータ2
     */
    public int getHalftoneParam2() {
<span class="fc" id="L723">        return halftoneParam2;</span>
    }

    /**
     * V2
     * 
     * @param halftoneParam2
     *            ハーフトーン時のパラメータ2
     */
    public void setHalftoneParam2(int halftoneParam2) {
<span class="fc" id="L733">        this.halftoneParam2 = halftoneParam2;</span>
<span class="fc" id="L734">    }</span>

    /**
     * V2
     * 
     * @return 符号化方式
     */
    public int getEncoding() {
<span class="fc" id="L742">        return encoding;</span>
    }

    /**
     * V2
     * 
     * @param encoding
     *            符号化方式
     */
    public void setEncoding(int encoding) {
<span class="fc" id="L752">        this.encoding = encoding;</span>
<span class="fc" id="L753">    }</span>

    /**
     * V2
     * 
     * @return 識別子
     */
    public int getId() {
<span class="fc" id="L761">        return id;</span>
    }

    /**
     * V2
     * 
     * @param id
     *            識別子
     */
    public void setId(int id) {
<span class="fc" id="L771">        this.id = id;</span>
<span class="fc" id="L772">    }</span>

    /**
     * @return カラーパレット
     */
    public List&lt;byte[]&gt; getColors() {
<span class="fc" id="L778">        return colors;</span>
    }

    /**
     * @param colors
     *            カラーパレット
     */
    public void setColors(List&lt;byte[]&gt; colors) {
<span class="fc" id="L786">        this.colors = colors;</span>
<span class="fc" id="L787">    }</span>

    /**
     * &lt;b&gt;カラーパレット 全消去&lt;/b&gt;
     */
    public void clearColors() {
<span class="fc" id="L793">        colors.clear();</span>
<span class="fc" id="L794">    }</span>

    /**
     * &lt;b&gt;カラーパレットに色追加&lt;/b&gt;
     * 
     * @param r
     *            赤 0 - 255
     * @param g
     *            緑 0 - 255
     * @param b
     *            青 0 - 255
     */
    public void addColor(int r, int g, int b) {
<span class="fc" id="L807">        byte[] color = { (byte) b, (byte) g, (byte) r, 0x00 };</span>
<span class="fc" id="L808">        colors.add(color);</span>
<span class="fc" id="L809">    }</span>

    /**
     * 12 バイト (RGB)&lt;br&gt;
     * もしくは&lt;br&gt;
     * 16 バイト (RGBA)
     * 
     * @return ビットフィールド
     */
    public byte[] getBitFields() {
<span class="fc" id="L819">        return Tools.endian(bitfields);</span>
    }

    /**
     * 12 バイト (RGB)&lt;br&gt;
     * もしくは&lt;br&gt;
     * 16 バイト (RGBA)
     * 
     * @param bitfields
     *            ビットフィールド
     */
    public void setBitFields(byte[] bitfields) {
<span class="fc" id="L831">        this.bitfields = Tools.endian(bitfields);</span>
<span class="fc" id="L832">    }</span>

    /**
     * @return 空の場合 true&lt;br&gt;
     *         空ではない場合 false
     */
    public boolean isEmptyBitFields() {
<span class="pc bpc" id="L839" title="1 of 4 branches missed.">        return bitfields == null || bitfields.length == 0;</span>
    }

    /**
     * V3 - V5
     * 
     * @return オプショナル
     */
    public byte[] getGap1() {
<span class="fc" id="L848">        return gap1;</span>
    }

    /**
     * V3 - V5
     * 
     * @param gap1
     *            オプショナル
     */
    public void setGap1(byte[] gap1) {
<span class="fc" id="L858">        this.gap1 = gap1;</span>
<span class="fc" id="L859">    }</span>

    /**
     * @return 空の場合 true&lt;br&gt;
     *         空ではない場合 false
     */
    public boolean isEmptyGap1() {
<span class="pc bpc" id="L866" title="1 of 4 branches missed.">        return gap1 == null || gap1.length == 0;</span>
    }

    /**
     * V5
     * 
     * @return オプショナル
     */
    public byte[] getGap2() {
<span class="fc" id="L875">        return gap2;</span>
    }

    /**
     * @param gap2
     *            オプショナル
     */
    public void setGap2(byte[] gap2) {
<span class="fc" id="L883">        this.gap2 = gap2;</span>
<span class="fc" id="L884">    }</span>

    /**
     * @return 空の場合 true&lt;br&gt;
     *         空ではない場合 false
     */
    public boolean isEmptyGap2() {
<span class="pc bpc" id="L891" title="1 of 4 branches missed.">        return gap2 == null || gap2.length == 0;</span>
    }

    /**
     * V5
     * 
     * @return プロファイル
     */
    public byte[] getProfile() {
<span class="fc" id="L900">        return profile;</span>
    }

    /**
     * V5
     * 
     * @param profile
     *            プロファイル
     */
    public void setProfile(byte[] profile) {
<span class="fc" id="L910">        this.profile = profile;</span>
<span class="fc" id="L911">    }</span>

    /**
     * @return 空の場合 true&lt;br&gt;
     *         空ではない場合 false
     */
    public boolean isEmptyProfile() {
<span class="pc bpc" id="L918" title="1 of 4 branches missed.">        return profile == null || profile.length == 0;</span>
    }

    /**
     * Listが縦、byte[]が横
     * 
     * @return ビットマップデータ
     */
    public List&lt;byte[]&gt; getImage() {
<span class="fc" id="L927">        return image;</span>
    }

    /**
     * Listが縦、byte[]が横
     * 
     * @param image
     *            ビットマップデータ
     */
    public void setImage(List&lt;byte[]&gt; image) {
<span class="fc" id="L937">        this.image = image;</span>
<span class="fc" id="L938">    }</span>

    /**
     * 1次元目は縦、2次元目は横
     * 
     * @param image
     *            ビットマップデータ
     */
    public void setImage(byte[][] image) {
<span class="fc" id="L947">        this.image.clear();</span>
<span class="fc bfc" id="L948" title="All 2 branches covered.">        for (byte[] i : image)</span>
<span class="fc" id="L949">            this.image.add(i);</span>
<span class="fc" id="L950">    }</span>

    /**
     * &lt;b&gt;画像データ 消去&lt;/b&gt;
     */
    public void clearImage() {
<span class="fc" id="L956">        image.clear();</span>
<span class="fc" id="L957">    }</span>

    /**
     * &lt;b&gt;入力&lt;/b&gt;
     * 
     * @param file
     *            ファイル先
     * @throws IOException
     */
    public void input(String file) throws IOException {
<span class="fc" id="L967">        clear();</span>
<span class="fc" id="L968">        FileInputStream in = null;</span>
<span class="fc" id="L969">        in = new FileInputStream(file);</span>
<span class="fc" id="L970">        int fileSize = in.available();</span>
<span class="fc" id="L971">        byte[] data = new byte[fileSize];</span>
<span class="fc" id="L972">        in.read(data);</span>
<span class="fc" id="L973">        in.close();</span>

        int infoHeaderSize;
        try {
<span class="fc" id="L977">            infoHeaderSize = Tools.bytes2int(Arrays.copyOfRange(data, 0x000E, 0x000E + 4));</span>
<span class="fc" id="L978">        } catch (ArrayIndexOutOfBoundsException e) {</span>
<span class="fc" id="L979">            throw new IOException(BMPable.ERROR_INVALID_HEADER_SIZE);</span>
        }
<span class="fc bfc" id="L981" title="All 5 branches covered.">        switch (infoHeaderSize) {</span>
            case BMPable.INFO_HEADER_SIZE_V3:
<span class="fc" id="L983">                bmp = new BMP_V3(data);</span>
<span class="fc" id="L984">                break;</span>
            case BMPable.INFO_HEADER_SIZE_V4:
<span class="fc" id="L986">                bmp = new BMP_V4(data);</span>
<span class="fc" id="L987">                break;</span>
            case BMPable.INFO_HEADER_SIZE_V5:
<span class="fc" id="L989">                bmp = new BMP_V5(data);</span>
<span class="fc" id="L990">                break;</span>
            case BMPable.INFO_HEADER_SIZE_V1:
<span class="fc" id="L992">                bmp = new BMP_V1(data);</span>
<span class="fc" id="L993">                break;</span>
            default:
<span class="fc bfc" id="L995" title="All 2 branches covered.">                if (infoHeaderSize &gt;= BMPable.INFO_HEADER_SIZE_V2_MIN</span>
<span class="fc bfc" id="L996" title="All 2 branches covered.">                        &amp;&amp; infoHeaderSize &lt;= BMPable.INFO_HEADER_SIZE_V2_MAX) {</span>
<span class="fc" id="L997">                    bmp = new BMP_V2(data);</span>
<span class="fc" id="L998">                } else {</span>
<span class="fc" id="L999">                    bmp = null;</span>
<span class="fc" id="L1000">                    throw new IOException(BMPable.ERROR_INVALID_HEADER_SIZE);</span>
                }
        }
<span class="fc" id="L1003">        BMP_V1 b1 = (BMP_V1) bmp;</span>
<span class="fc" id="L1004">        setType(b1.getType());</span>
<span class="fc" id="L1005">        setFileSize(b1.getFileSize());</span>
<span class="fc" id="L1006">        setImageOffset(b1.getOffset());</span>
<span class="fc" id="L1007">        setInfoHeaderSize(b1.getInfoHeaderSize());</span>
<span class="fc" id="L1008">        setWidth(b1.getWidthV1());</span>
<span class="fc" id="L1009">        setHeight(b1.getHeightV1());</span>
<span class="fc" id="L1010">        setBitCount(b1.getBitCount());</span>
<span class="fc" id="L1011">        setColors(b1.getColors());</span>
<span class="fc" id="L1012">        setImage(b1.getImage());</span>
<span class="fc bfc" id="L1013" title="All 2 branches covered.">        if (bmp.getVersion() &gt;= 2) {</span>
<span class="fc" id="L1014">            BMP_V3 b3 = (BMP_V3) bmp;</span>
<span class="fc" id="L1015">            setWidth(b3.getWidth());</span>
<span class="fc" id="L1016">            setHeight(b3.getHeight());</span>
<span class="fc" id="L1017">            setCompression(b3.getCompression());</span>
<span class="fc" id="L1018">            setImageSize(b3.getSizeImage());</span>
<span class="fc" id="L1019">            setPixPerMeterX(b3.getXPelsPerMeter());</span>
<span class="fc" id="L1020">            setPixPerMeterY(b3.getYPelsPerMeter());</span>
<span class="fc" id="L1021">            setCirImportant(b3.getCirImportant());</span>
<span class="fc bfc" id="L1022" title="All 2 branches covered.">            if (bmp.getVersion() &gt;= 3) {</span>
<span class="fc" id="L1023">                setInfoHeaderSize(b3.getInfoHeaderSize());</span>
<span class="fc bfc" id="L1024" title="All 2 branches covered.">                if (!b3.isEmptyGap1()) {</span>
<span class="fc" id="L1025">                    setGap1(b3.getGap1());</span>
                }
<span class="fc bfc" id="L1027" title="All 2 branches covered.">                if (!b3.isEmptyGap2()) {</span>
<span class="fc" id="L1028">                    setGap2(b3.getGap2());</span>
                }
<span class="fc bfc" id="L1030" title="All 2 branches covered.">                if (bmp.getVersion() &gt;= 4) {</span>
<span class="fc" id="L1031">                    BMP_V4 b4 = (BMP_V4) bmp;</span>
<span class="fc" id="L1032">                    setRedMask(b4.getRedMask());</span>
<span class="fc" id="L1033">                    setGreenMask(b4.getGreenMask());</span>
<span class="fc" id="L1034">                    setBlueMask(b4.getBlueMask());</span>
<span class="fc" id="L1035">                    setAlphaMask(b4.getAlphaMask());</span>
<span class="fc" id="L1036">                    setCSType(b4.getCSType());</span>
<span class="fc" id="L1037">                    setCiexyzTriple(b4.getEndpoints());</span>
<span class="fc" id="L1038">                    setGammaRed(b4.getGammaRed());</span>
<span class="fc" id="L1039">                    setGammaGreen(b4.getGammaGreen());</span>
<span class="fc" id="L1040">                    setGammaBlue(b4.getGammaBlue());</span>
<span class="fc bfc" id="L1041" title="All 2 branches covered.">                    if (bmp.getVersion() == 5) {</span>
<span class="fc" id="L1042">                        BMP_V5 b5 = (BMP_V5) bmp;</span>
<span class="fc" id="L1043">                        setIntent(b5.getIntent());</span>
<span class="fc" id="L1044">                        setProfileOffset(b5.getProfileData());</span>
<span class="pc bpc" id="L1045" title="1 of 2 branches missed.">                        if (!b5.isEmptyProfile()) {</span>
<span class="nc" id="L1046">                            setProfile(b5.getProfile());</span>
                        }
                    }
                }
<span class="nc" id="L1050">            } else {</span>
<span class="fc" id="L1051">                BMP_V2 b2 = (BMP_V2) bmp;</span>
<span class="fc" id="L1052">                setHeaderSize(b2.getHeaderSize());</span>
<span class="fc" id="L1053">                setHotspotX(b2.getHotspotX());</span>
<span class="fc" id="L1054">                setHotspotY(b2.getHotspotY());</span>
<span class="fc" id="L1055">                setResolution(b2.getResolution());</span>
<span class="fc" id="L1056">                setFormat(b2.getFormat());</span>
<span class="fc" id="L1057">                setHalftone(b2.getHalftone());</span>
<span class="fc" id="L1058">                setHalftoneParam1(b2.getHalftoneParam1());</span>
<span class="fc" id="L1059">                setHalftoneParam2(b2.getHalftoneParam2());</span>
<span class="fc" id="L1060">                setEncoding(b2.getEncoding());</span>
<span class="fc" id="L1061">                setId(b2.getId());</span>
            }
        }
<span class="fc" id="L1064">    }</span>

    /**
     * &lt;b&gt;出力&lt;/b&gt;
     * 
     * @param file
     *            ファイル先
     * @throws IOException
     */
    public void output(String file) throws IOException {
<span class="fc" id="L1074">        output(file, bmp.getVersion());</span>
<span class="fc" id="L1075">    }</span>

    /**
     * &lt;b&gt;出力&lt;/b&gt;
     * 
     * @param file
     *            ファイル先
     * @param version
     *            バージョン
     * @throws IOException
     */
    public void output(String file, int version) throws IOException {
<span class="fc bfc" id="L1087" title="All 2 branches covered.">        if (version != 2) {</span>
<span class="fc bfc" id="L1088" title="All 5 branches covered.">            switch (version) {</span>
                case 1:
<span class="fc" id="L1090">                    infoHeaderSize = BMPable.INFO_HEADER_SIZE_V1;</span>
<span class="fc" id="L1091">                    break;</span>
                case 3:
<span class="fc" id="L1093">                    infoHeaderSize = BMPable.INFO_HEADER_SIZE_V3;</span>
<span class="fc" id="L1094">                    break;</span>
                case 4:
<span class="fc" id="L1096">                    infoHeaderSize = BMPable.INFO_HEADER_SIZE_V4;</span>
<span class="fc" id="L1097">                    break;</span>
                case 5:
<span class="fc" id="L1099">                    infoHeaderSize = BMPable.INFO_HEADER_SIZE_V5;</span>
<span class="fc" id="L1100">                    break;</span>
                default:
<span class="fc" id="L1102">                    throw new IOException(BMPable.ERROR_UNSUPPORTED_VERSION);</span>
            }
<span class="nc" id="L1104">        } else {</span>
<span class="pc bpc" id="L1105" title="1 of 2 branches missed.">            if (infoHeaderSize &lt; BMPable.INFO_HEADER_SIZE_V2_MIN) {</span>
<span class="nc" id="L1106">                infoHeaderSize = BMPable.INFO_HEADER_SIZE_V2_MIN;</span>
            }
<span class="fc bfc" id="L1108" title="All 2 branches covered.">            if (infoHeaderSize &gt; BMPable.INFO_HEADER_SIZE_V2_MAX) {</span>
<span class="fc" id="L1109">                infoHeaderSize = BMPable.INFO_HEADER_SIZE_V2_MAX;</span>
            }
        }
<span class="fc" id="L1112">        imageSize = 0;</span>
<span class="fc bfc" id="L1113" title="All 2 branches covered.">        for (byte[] img : image) {</span>
<span class="fc" id="L1114">            imageSize += img.length;</span>
        }
<span class="pc bpc" id="L1116" title="1 of 4 branches missed.">        int optSize = (bitCount &lt;= 8) ? colors.size() * ((version == 1) ? 3 : 4)</span>
<span class="pc bpc" id="L1117" title="1 of 8 branches missed.">                : ((bitCount == 16 || bitCount == 32)) ? (compression == 3) ? 12 : (compression == 6) ? 16 : 0 : 0;</span>
<span class="pc bpc" id="L1118" title="1 of 4 branches missed.">        int gap1Size = (!isEmptyGap1() &amp;&amp; version &gt;= 3) ? gap1.length : 0;</span>
<span class="pc bpc" id="L1119" title="1 of 4 branches missed.">        int gap2Size = (!isEmptyGap2() &amp;&amp; version &gt;= 3) ? gap2.length : 0;</span>
<span class="pc bpc" id="L1120" title="1 of 4 branches missed.">        profileSize = (isEmptyProfile() &amp;&amp; version == 5) ? profile.length : 0;</span>
<span class="fc" id="L1121">        imageOffset = getHeaderSize() + optSize + gap1Size;</span>
<span class="fc" id="L1122">        profileOffset = imageOffset + imageSize + gap2Size - BMPable.FILE_HEADER_SIZE;</span>
<span class="fc" id="L1123">        fileSize = imageOffset + imageSize + gap2Size + profileSize;</span>

<span class="pc bpc" id="L1125" title="1 of 6 branches missed.">        switch (version) {</span>
            case 1:
<span class="fc" id="L1127">                bmp = new BMP_V1(this);</span>
<span class="fc" id="L1128">                break;</span>
            case 2:
<span class="fc" id="L1130">                bmp = new BMP_V2(this);</span>
<span class="fc" id="L1131">                break;</span>
            case 3:
<span class="fc" id="L1133">                bmp = new BMP_V3(this);</span>
<span class="fc" id="L1134">                break;</span>
            case 4:
<span class="fc" id="L1136">                bmp = new BMP_V4(this);</span>
<span class="fc" id="L1137">                break;</span>
            case 5:
<span class="fc" id="L1139">                bmp = new BMP_V5(this);</span>
                break;
        }

<span class="fc" id="L1143">        File check = new File(file.substring(0, file.lastIndexOf(&quot;\\&quot;)));</span>
<span class="pc bpc" id="L1144" title="1 of 2 branches missed.">        if (!check.exists()) {</span>
<span class="nc" id="L1145">            check.mkdirs();</span>
        }

<span class="fc" id="L1148">        FileOutputStream out = null;</span>
<span class="fc" id="L1149">        out = new FileOutputStream(file);</span>
<span class="fc" id="L1150">        out.write(bmp.get());</span>
<span class="fc" id="L1151">        out.flush();</span>
<span class="fc" id="L1152">        out.close();</span>
<span class="fc" id="L1153">    }</span>

    /**
     * &lt;b&gt;初期化&lt;/b&gt;
     */
    public void clear() {
<span class="fc" id="L1159">        bmp = new BMP_V3();</span>
<span class="fc" id="L1160">        type = new byte[] { 0x42, 0x4D };</span>
<span class="fc" id="L1161">        fileSize = 0;</span>
<span class="fc" id="L1162">        imageOffset = 0;</span>
<span class="fc" id="L1163">        infoHeaderSize = 0;</span>
<span class="fc" id="L1164">        width = 0;</span>
<span class="fc" id="L1165">        height = 0;</span>
<span class="fc" id="L1166">        bitCount = 0;</span>
<span class="fc" id="L1167">        compression = 0;</span>
<span class="fc" id="L1168">        imageSize = 0;</span>
<span class="fc" id="L1169">        pixPerMeterX = 0;</span>
<span class="fc" id="L1170">        pixPerMeterY = 0;</span>
<span class="fc" id="L1171">        cirImportant = 0;</span>
<span class="fc" id="L1172">        redMask = ByteBuffer.allocate(4).putInt(0).array();</span>
<span class="fc" id="L1173">        greenMask = ByteBuffer.allocate(4).putInt(0).array();</span>
<span class="fc" id="L1174">        blueMask = ByteBuffer.allocate(4).putInt(0).array();</span>
<span class="fc" id="L1175">        alphaMask = ByteBuffer.allocate(4).putInt(0).array();</span>
<span class="fc" id="L1176">        csType = ByteBuffer.allocate(4).putInt(0).array();</span>
<span class="fc" id="L1177">        ciexyzTriple = ByteBuffer.allocate(36).putLong(0).putLong(0).putLong(0).putLong(0).putInt(0).array();</span>
<span class="fc" id="L1178">        gammaRed = 0.0f;</span>
<span class="fc" id="L1179">        gammaGreen = 0.0f;</span>
<span class="fc" id="L1180">        gammaBlue = 0.0f;</span>
<span class="fc" id="L1181">        intent = 0;</span>
<span class="fc" id="L1182">        profileOffset = 0;</span>
<span class="fc" id="L1183">        profileSize = 0;</span>
<span class="fc" id="L1184">        headerSize = 0;</span>
<span class="fc" id="L1185">        hotspotX = 0;</span>
<span class="fc" id="L1186">        hotspotY = 0;</span>
<span class="fc" id="L1187">        resolution = 0;</span>
<span class="fc" id="L1188">        format = 0;</span>
<span class="fc" id="L1189">        halftone = 0;</span>
<span class="fc" id="L1190">        halftoneParam1 = 0;</span>
<span class="fc" id="L1191">        halftoneParam2 = 0;</span>
<span class="fc" id="L1192">        encoding = 0;</span>
<span class="fc" id="L1193">        id = 0;</span>
<span class="fc" id="L1194">        colors.clear();</span>
<span class="fc" id="L1195">        bitfields = new byte[0];</span>
<span class="fc" id="L1196">        gap1 = new byte[0];</span>
<span class="fc" id="L1197">        gap2 = new byte[0];</span>
<span class="fc" id="L1198">        profile = new byte[0];</span>
<span class="fc" id="L1199">        image.clear();</span>
<span class="fc" id="L1200">    }</span>

    /**
     * @return バージョン
     */
    public int getVersion() {
<span class="fc" id="L1206">        return bmp.getVersion();</span>
    }

    /**
     * バージョンの値は 1 から 5 まで&lt;br&gt;
     * バージョンの値が範囲外の場合、デフォルトとして 3 に設定される。
     * 
     * @param version
     *            バージョン
     */
    public void setVersion(int version) {
<span class="fc bfc" id="L1217" title="All 5 branches covered.">        switch (version) {</span>
            case 1:
<span class="fc" id="L1219">                bmp = new BMP_V1();</span>
<span class="fc" id="L1220">                break;</span>
            case 2:
<span class="fc" id="L1222">                bmp = new BMP_V2();</span>
<span class="fc" id="L1223">                break;</span>
            case 4:
<span class="fc" id="L1225">                bmp = new BMP_V4();</span>
<span class="fc" id="L1226">                break;</span>
            case 5:
<span class="fc" id="L1228">                bmp = new BMP_V5();</span>
<span class="fc" id="L1229">                break;</span>
            default:
<span class="fc" id="L1231">                bmp = new BMP_V3();</span>
                break;
        }
<span class="fc" id="L1234">    }</span>

    @Override
    public String toString() {
<span class="fc" id="L1238">        return bmp.toString();</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.7.9.201702052155</span>paint (2018/03/28 9:59:50)</div></body></html>